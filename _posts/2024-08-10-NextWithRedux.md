---
layout: single
title:  "새로운 Next.js 아키텍쳐에서 Redux 사용"
categories: Frontend
tags: [Next.js, Server-Side-Rendering, Redux]

author_profile: false
search: true
---

# Redux
`Redux`를 간단하게 설명하자면, `JavaScript` 애플리케이션에서 상태 관리를 위한 라이브러리 라고 할 수 있겠다. `Redux`는 크게 `Action`, `Reducer`, `Store`로 역할이 나뉘어 지고 다음과 같이 정의된다.
- `Action`: 상태를 변경하기 위한 신호
- `Reducer`: 액션에 따라 상태를 업데이트 하는 함수
- `Store`: 상태가 저장되는 장소

`Redux`는 이 세가지 개념을 통해 애플리케이션의 모든 상태를 전역적으로 관리한다. 이를 통해 상태 관리의 복잡성을 줄이고 디버깅 및 테스트를 용이하게 한다.

## Redux with React
`Redux`는 주로 `React`와 함께 사용된다. `React`를 사용하여 애플리케이션을 만들게 되면, 애플리케이션은 흔히 말하는 '리액트 방식' 으로 렌더링이 된다. 여기서 말하는 '리액트 방식' 이란, 'Client-Side-Rendering' 을 말한다. 다음 그림은 이 'Client-Side-Rendering' 을 잘 설명한다.

<img src="../../images/2024-08-10/CSR.png" alt="CSR" style="zoom:50%;" />

클라이언트 사이드 렌더링에서 말하는 '클라이언트' 란 '브라우저' 를 말한다.  
유저가 브라우저에서 어떤 페이지 (예를 들어`'/'`)를 열었다면 그 요청은 프론트엔드 서버로 전송이 된다. 전통적인 렌더링 방식이라면, 요청을 받은 프론트엔드 서버는 요청에 필요한 모든 정보를 수집해서 렌더링을 하고 `HTML` 파일을 만들어 브라우저로 전송을 하게 된다.  
하지만 클라이언트 사이드 렌더링에선 요청을 받은 프론트 서버는 일단 `html`, `img`, `js` 그리고 모든 컴포넌트 파일들을 __데이터 없이__ 브라우저로 보내준다. 브라우저는 데이터가 없는 파일들을 받아 렌더링을 하고 데이터가 필요한 경우 프론트 서버에서 전달 받은 컴포넌트 파일과 (리덕스를 사용할 경우) 리덕스의 설정 파일들을 통해 직접 백엔드와 소통을 하게 된다. 그리고 백엔드는 데이터를 다시 클라이언트로 전송을 하고, 데이터를 받은 브라우저는 페이지에 데이터들을 보여주게 된다.

`Redux`를 사용한다는 것은 컴포넌트 사용에 필요한 상태 (`state`) 들을 중앙 저장소 (`store`)에 저장을 하고 관리를 한다는 뜻이다. 클라이언트의 요청을 받은 백엔드는 그 요청을 처리해서 응답을 보내준다. 그 응답은 종류 (성공 또는 실패)에 따라 `Reducer`에서 다르게 처리가 되고, 상태 값들은 중앙 저장소에 저장이 된다.

여기서 주목해야 할 점은 <strong>모든 클라이언트의 요청은 클라이언트, 즉 브라우저에서 처리가 된다는 점</strong> 이다. 리덕스 스토어는 브라우저의 메모리에서 관리가 되며, 전역적으로 한 개의 스토어가 있어도 요청 간의 상태 충돌 문제도 발생하지 않는다.

나는 이 개념을 다음과 같이 이해를 했다.  

*사용자 A가 브라우저에서 어떤 페이지를 연다고 가정했을 때, 그 요청을 날리는 사람, 즉 사용자도 한명이고, 그 요청을 처리하는 브라우저도 한 개이다. 그리고 그 브라우저에서 관리하는 리덕스 스토어도 한 개이다. 사용자 B는 사용자 A가 사용하는 브라우저에 접근할 수 없으며, 따라서 두 사용자 간의 요청이 충돌하지 않는다.*

이 개념을 이렇게 먼저 설명하는 이유는 다음 챕터에서 설명하게 될 `Next.js` 와 `Redux`는 조금 다르기 때문이다.

# Next.js with Redux
[Redux Toolkit Setup with Next.js](https://redux.js.org/usage/nextjs) 에서 새로운 `Next.js` 아키텍쳐인 `AppRouter` 에서 `Redux` 세팅을 할 때 세가지를 권장하고 있다.
1. 글로벌 스토어 금지: `Redux` 스토어가 글로벌 변수로 정의되면 요청 간에 공유가 될 수 있다. 이는 데이터 오염을 초래할 수 있기 때문에 요청별로 스토어가 새로 생성되어야 한다.
2. RSC (React Server Component) 에서 Redux 사용 금지: React Server Component, RSC, 는 상태를 관리하지 않고 훅 (hook)이나 컨텍스트를 사용할 수 없다. 따라서 RSC에서 `Redux` 스토어에 접근하거나 수정하는 것은 `Next.js` 와 맞지 않다.
3. 스토어에 변할 수 있는 데이터만 저장: Redux는 글로벌 및 변할 수 있는 데이터를 관리하기 위해 사용해야 한다. 이는 서버와 클라이언트 간의 데이터 관리와 일관성을 유지하는데 도움이 된다.

